{% extends 'staff_base.html' %}

{% block title %}Chef Dashboard{% endblock %}

{% block content %}
<h1>Welcome, Chef {{ staff.full_name }}!</h1>

<h2>Pending Orders</h2>
{% if pending_orders %}
  <table>
    <thead>
      <tr>
        <th>Order ID</th>
        <th>Customer</th>
        <th>Items</th>
        <th>Date & Time</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for order in pending_orders %}
      <tr>
        <td>{{ order.id }}</td>
        <td>{{ order.customer.full_name }}</td>
        <td>
          <ul>
            {% for item in order.items.all %}
            <li>{{ item.quantity }} x {{ item.menu_variant.menu.name }} - {{ item.menu_variant.variant_name }}</li>
            {% endfor %}
          </ul>
        </td>
        <td>{{ order.date_time }}</td>
        <td>
          <form action="{% url 'update_order_status' order.id %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="order_status" value="preparing">
            <button type="submit">Start Preparing</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>No pending orders.</p>
{% endif %}

<h2>Pre-orders for Reservations</h2>
{% if preorders %}
  <table>
    <thead>
      <tr>
        <th>Reservation ID</th>
        <th>Customer</th>
        <th>Pre-ordered Items</th>
        <th>Date & Time</th>
      </tr>
    </thead>
    <tbody>
      {% for preorder in preorders %}
      <tr>
        <td>{{ preorder.reservation.id }}</td>
        <td>{{ preorder.reservation.customer.full_name }}</td>
        <td>{{ preorder.quantity }} x {{ preorder.menu_variant.menu.name }} - {{ preorder.menu_variant.variant_name }}</td>
        <td>{{ preorder.reservation.date }} {{ preorder.reservation.time }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>No pre-orders for reservations.</p>
{% endif %}

<h2>Upcoming Events</h2>
{% if upcoming_events %}
  <table>
    <thead>
      <tr>
        <th>Event ID</th>
        <th>Customer</th>
        <th>Event Date</th>
        <th>Menu Items</th>
        <th>Custom Dishes</th>
      </tr>
    </thead>
    <tbody>
      {% for event in upcoming_events %}
      <tr>
        <td>{{ event.id }}</td>
        <td>{{ event.customer.full_name }}</td>
        <td>{{ event.event_date }}</td>
        <td>
          <ul>
            {% for item in event.menu_items.all %}
            <li>{{ item.name }}</li>
            {% endfor %}
          </ul>
        </td>
        <td>{{ event.custom_dish }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>No upcoming events.</p>
{% endif %}
{% endblock %}
